%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Real
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{无量纲处理}
宇宙中各天体的自转或公转周期通常以天甚至以年计算，
且轨道速度快，空间尺度大。
如果按照实际参数进行仿真，
则仿真的计算量太大而无法实时计算。
为了能够在仿真时直观地实时展示仿真结果，
需要对一些公式的单位进行换算。

万有引力公式
\begin{equation}
    \frac{\text{d}^2\vec{r}}{\text{d}t^2}=-\frac{\mu}{r^3}\vec{r} \label{eqRealGravity}
\end{equation}
中，$r$的单位是km，$t$的单位是s。
因为实际的尺度太大，一个天文单位达到了$10^8$数量级，
为了便于仿真，
需要将实际尺度中的时间和距离变换到一个合适的时空坐标系下。
首先列举一些名词解释。
\textbf{实际时间}指宇宙尺度上的实际时间；
\textbf{无单位求解器时间}指微分方程求解器中自变量的值，
没有单位，简称求解器时间，
对应的求解器速度和求解器距离也都没有单位；
\textbf{仿真展示软件消耗时间}：例如仿真展示软件运行1秒对应实际时间的1000秒，
此处的1秒指的是是仿真展示软件消耗时间，简称展示时间。

举例说明，
求解器时间的1单位时间等于实际时间的$10^4$秒，
1单位距离等于实际距离$10^6$km，即在求解器中，
\begin{equation}
    \bar{t}=10^{-4}t,\ \bar{r}=10^{-6}r \label{eqRealConvert}
\end{equation}
其中$t$和$r$分别为以秒和千米为单位的实际时间和实际距离，
而$\bar{t}$和$\bar{r}$分别表示求解器时间和求解器距离。
1个天文单位为$r=1.5\times10^8$km，
则求解器中的1个天文单位为$\bar{r}=150$。
然后可以计算出实际时间/速度/距离
和求解器时间/速度/距离之间的一些换算关系
\begin{align*}
&\bar{v} = \frac{\text{d}\bar{r}}{\text{d}\bar{t}}
 = \frac{10^{-6}\text{d}r}{10^{-4}\text{d}t} = 10^{-2}v \\
&\bar{a} = \frac{\text{d}}{\text{d}\bar{t}}\frac{\text{d}\bar{r}}{\text{d}\bar{t}}
 = 10^2\frac{\text{d}^2r}{\text{d}t^2} = 10^2a \\
&\bar{\mu}\left[\frac{(10^{-6}\text{km})^3}{(10^{-4}\text{s})^2}\right]
 = 10^{-10}\mu\left[\frac{\text{km}^3}{\text{s}^2}\right] \\
&-\frac{\bar{\mu}}{\bar{r}^2} = -10^2\frac{\mu}{r^2}
 = 10^2\frac{\text{d}^2r}{\text{d}t^2} = \bar{a}
\end{align*}
其中引力常数$\mu$的单位中包含时间/距离量纲，
因此也需要换算。
可以验证，实际中的微分方程
$$a=-\frac{\mu}{r^2}$$
变换到求解器中仍然为
$$\bar{a}=-\frac{\bar{\mu}}{\bar{r}^2}$$

下面在换算公式\eqref{eqRealConvert}的基础上引入仿真展示软件消耗时间。
若仿真步长设置为0.01求解器时间，仿真展示软件每帧仿真10步，
则换算到实际时间上的步长为100秒，每帧代表1000秒，
按60帧计算，则展示时间1秒等于实际时间$6\times10^4$秒，
地球的轨道速度按30km/s算则展示时间1秒内地球走过$1.8\times10^6$km，
换算回仿真中则走过1.8展示距离。
换一种方法计算，
地球的求解器速度是$\bar{v}=10^{-2}\times30=0.3$，
仿真展示软件每1秒仿真：
60帧$\times$10步/帧$\times$0.01单位时间/步=6个时间单位，
也可以得到展示时间1秒内地球走过1.8展示距离。
在式\eqref{eqRealConvert}的设定下，
仿真展示软件每帧仿真1步与10步对应的地球自转周期分别约为$14.4$和$1.44$秒，
分别可用于展示低轨卫星和地球同步卫星的动态运行结果。

与实时仿真不同的是实际中广泛使用的非实时仿真，
也就是在一次仿真结束后展示静态仿真结果。
此时虽然不需要考虑展示时间/速度/距离，
但求解器时间/速度/距离仍然需要考虑。

单位换算在显著加快仿真速度的同时，
微分方程数值求解的精度也会受到影响。
已知四阶龙格库塔法的局部截断误差为$O(h^5$)\cite{mqingyang2019}，
取无量纲步长为$h_0=10^{-3}$，
对微分方程
\[\frac{\text{d}\bar{r}}{\text{d}\bar{t}}=\bar{v}\]
局部截断误差为$\Delta\bar{r}=Ch_0^5=10^{-15}C$，
换算回真实值得到$\Delta r=10^6\Delta\bar{r}=10^{-9}C$，
同理可得
$\Delta v=10^2\Delta\bar{v}=10^{-13}C$，
$\Delta a=10^{-2}\Delta\bar{a}=10^{-17}C$。
以$r$为例，
换算单位前仿真10秒的累积误差为
\[e_1=10^4C\times 10^{-15}=10^{-11}C\]
换算单位后，时间单位换算成万秒，
仍取无量纲步长$h_0=10^{-3}$，
即实际步长为$h_2=10^{-3}$万秒，
仿真10秒就是1个步长，累积误差等于局部截断误差
\[e_2=10^{-9}C\]
若不换算单位而只是改变步长，
取步长$h_3=1$秒，
尽管实际上$h_3=10h_2$，
但仿真10秒的累积误差高达
\[e_3=10C\times 1^5=10C\]
因此在不同的仿真中，
在数值求解的仿真步长不变的前提下，
使用单位换算的方法可以显著提高仿真速度，
同时也能保证仿真精度不会显著下降，
对于一些高阶导量甚至提高了仿真精度。
